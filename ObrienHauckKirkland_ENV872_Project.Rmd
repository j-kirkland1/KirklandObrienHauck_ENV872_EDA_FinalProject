---
title: "Spatial, Temporal, and Depth Distributions of Mercury Contamination in the Penobscot River, Maine"
author: "Sloane Hauck, Julia Kirkland, Meg O'Brien, and Cira Ortiz"
output: pdf_document
toc: true
lof: true
lot: true
geometry: margin=2.54cm
editor_options: 
  chunk_output_type: console
---
\listoftables 
```{r project.setup, results='hide', echo=FALSE, message=FALSE, warning=FALSE, error=FALSE}
packages <- c("tidyverse", "readxl", "dplyr", "lubridate", "sp", "sf","mapview",
              "knitr", "here", "ggplot2", "zoo", "trend")

check.packages <- function(pkg){
  new.pkg <- pkg[!(pkg %in% installed.packages()[, "Package"])]
  if(length(new.pkg))
    install.packages(new.pkg, dependencies = TRUE)
  sapply(pkg, require, character.only = TRUE)
}
check.packages(packages)

'%ni%' <- Negate('%in%')


#Add theme here:

Mytheme <- theme_classic (base_size = 14) +
theme(
plot.title = element_text(size = 16, face = 'bold', hjust = 0.5),
axis.text = element_text(color = 'black'),
axis.title.x = element_text(hjust = 0.5, vjust = 2, size = 14),
axis.title.y = element_text(hjust = 0.5, vjust = 2, angle = 90, size = 14), 
legend.position = 'top', 
legend.title = element_text(face = 'italic'),
plot.background = element_rect(fill = "white"),   
panel.background = element_rect(fill = "lavenderblush"),
panel.grid.major = element_line(color = 'gray90'), 
panel.grid.minor = element_line(color = 'gray95'),
panel.border = element_rect(color = "gray70", fill = NA),
axis.ticks = element_line(color = "black", size = 0.5))

theme_set(Mytheme)

```

## Background

The Penobscot River in Maine has been the object of environmental concern
and focus for years. It is the largest watershed in New England and hosts 
the largest run of Atlantic salmon on the East Coast. Despite its ecological 
importance, the watershed has experienced significant degradation due to high 
levels of mercury contamination by a chemical plant. In 1967, a pharmaceutical 
company, Mallinckrodt began discharging mercury into the river as part of its
paper-production process, leaving 13 tons of Mercury in the river by 1970. 

Mercury is a particularly worrisome and challenging contaminant because it 
does not easily break down. The contamination has had a significant and 
lasting impact on the surrounding ecosystem and nearby communities. The 
state of Maine issued an advisory warning pregnant women against eating 
certain species harvested from the river, and certain lobster and 
crab fisheries have been shut down. 

However, due to the steadfast and tenacious efforts of environmental advocates, 
this story has a silver lining. Senior attorney Nancy Marks from the NRDC 
(the Natural Resources Defense Council) filed a lawsuit in 1998, and after two
decades of litigation, a major legal breakthrough was achieved. In 2022, the 
district attorney of Maine settled the long-running case, requiring Mallinckrodt 
to pay $197 million in remediation for the mercury damage. 

Because this watershed has been the subject of extensive study to document 
the need for remediation, there is considerable data about its sediment history.
NOAA has compiled datasets on sediment, soil, and tissue chemistry from various 
studies of the Penobscot watershed. Using this data, we will examine mercury
levels in the sediment.


## Research Questions and Hypotheses

Enter questions and hypotheses here

Research Questions: 

Question 1. How do mercury contamination levels change over time in the 
sediments in the Penobscot River? 
Question 2. Does mercury contamination increase with depth?

Hypothesis 1 : Post closure of the site, we would expect that mercury levels 
in surface sediment will decrease over time and as they get further away from 
the site due to natural attenuation. 

Hypothesis 2: Over time, mercury concentrations have decreased in the 
Penobscot River due to sedimentation in the river.


## Dataset Information

Summarize where data came from, variables used, etc. 

```{r intro.table.data, echo=FALSE}

#Creates a table summarizing information about the dataset
DatasetInfo <- data.frame(Item = c("Data Source", "Date Range", 
                                   "Number of Records ", "Records with Coordinates"),
                          Value = c("NOAA DIVER", "June 1st, 1970 to May 5th, 2021", 
                                    "28,058", "24,501"))

knitr::kable(DatasetInfo, align = c('l', 'l'))

```

```{r setup.spatial.databases, echo=FALSE}

#Create a point layer of the site coordinates (44.740733, -68.825704)
Lat <- 44.740733
Long <- -68.825704
Name <- "HoltraChem Site"
Site <- data.frame("Site" = Name, "Longitude" = Long, "Latitude" = Lat) %>% 
  st_as_sf(coords=c("Longitude", "Latitude"), crs=4269)

#Penobscot River shapefile
Penobscot <- st_read(here("./Shapefiles/Penobscot_River.shp")) 
Penobscot_clean <- Penobscot %>% 
  st_transform(crs=4269)

mapview(Penobscot_clean)

```

## Data Exploration

Look at what is included in the data and make some initial figures

```{r data.exploration, echo=FALSE}

#Reading in the dataset
data_raw <- read.csv(here("./Raw Data/DIVER_Penobscot_Mercury_2025_11_18_Samples.csv"))

colnames(data_raw)

#Start by subsetting the data to only include columns of interest
#Then we will flag data that has coordinate information
data_wrangle_1 <- data_raw %>% 
  select(Case_Activity, Site_ID, Study_Name, Area_Description, Matrix_Group,
         Station, Date, Sample_ID, Sample_Upper_Depth, Sample_Lower_Depth,
         Sample_Depth_Unit, Depth_Category, Lab_Replicate, ChemCode, Max_Result_.Raw.,
         Analysis_Result_Unit, Start_Latitude, Start_Longitude) %>% 
  mutate(
    Coordinate_Flag = if_else(!is.na(Start_Longitude), "Y", "N"),
    Date = as.Date(Date))

#Here we create a new subset of the data that only includes records with coordinates
#We also make this version of the dataset spatial for future mapping
data_wrangle_2 <- data_wrangle_1 %>% 
  filter(Coordinate_Flag == "Y") %>% 
  filter(Start_Latitude < 44.74788) %>% #this is making sure that we only have data points downstream of the site
  st_as_sf(coords = c("Start_Longitude", "Start_Latitude"),
           crs = 4269)

glimpse(data_wrangle_2)
summary(data_wrangle_2$Max_Result_.Raw.)
#from the summary we see that some results are -9, this is NOAAs method of listing
#denoting that no data is available, so we should exclude it

unique(data_wrangle_2$Analysis_Result_Unit)
#we also see that there are two units, PPM and mg/L. Upon further investigation,
#there is only one record with mg/L, so we will exclude it because that is not a
#valid unit for solids

unique(data_wrangle_2$Sample_Depth_Unit)
#Some of the data has no, or inconsistent depth data, we will need to come up with an average depth value for further analysis

```

Below data exploration/graphing is very preliminary, could use some additional attention to make the figures look nice.

```{r data.exploration.figures, echo=FALSE}

#Plot Depths and Concentration
ggplot(data_wrangle_2, aes(x=Date, y=Sample_Upper_Depth, fill=Max_Result_.Raw.)) +
  geom_point(shape=21) +
  scale_y_reverse() +
  labs(y="Depth (cm)", fill="Concentration (PPM)") 


#Map samples to Penobscot River
mapview(Penobscot) + mapview(data_wrangle_2, 
                                                   col.regions = "grey", 
                                                   alpha.regions = 0.5)

#Plot concentrations samples over time - gap between 1970 and mid 90s identified
ggplot(data_wrangle_2, aes(x=Date, y=Max_Result_.Raw.)) +
  geom_point() +
  labs(y="Concentration (PPM)",
       title = "Mercury Concentrations 1970-2021") +
  geom_hline(yintercept = 1.06, color = "red")
#this line represents the mercury PEC, above which harmful effects to sediment dwelling biota are likely to be observed.

```

Based on above discoveries, we need to spatially limit the samples to the river extent, filter out records with -9 as a result, and filter out mg/L units. Also, after a preliminary review, we found that very few, if any, samples were collected between 1970 and 2000. This gap limits our ability to conduct a robust long-term time-series analysis and constrains our capacity to assess the direct impact of the 1967 contamination event. However, the absence of data also reflects a broader theme in our findings- a historical lack of environmental oversight and policy that allowed the companyâ€™s actions to go unchecked. During this period, environmental concerns were not prioritized, resulting in limited industry vigilance and insufficient funding for scientific monitoring. To account for this gap, we restricted our analysis to data collected between 2000 and 2021.


## Data Wrangling 

Describe what steps are happening in the data wrangling section below

```{r data.cleaning}

#filter out -9 in results and mg/L units
#also converting sample depths to feet
data_wrangle_3 <- data_wrangle_2 %>% 
  filter(Max_Result_.Raw. >= 0) %>% 
  filter(Analysis_Result_Unit == "PPM") %>% 
  mutate(Upper_Depth_ft = if_else(Sample_Upper_Depth >= 0, 
                                  Sample_Upper_Depth*0.0328084,
                                  Sample_Upper_Depth),
         Lower_Depth_ft = if_else(Sample_Lower_Depth >= 0,
                                  Sample_Lower_Depth*0.0328084,
                                  Sample_Lower_Depth),
         Avg_Depth_ft = if_else(Upper_Depth_ft >= 0 & Lower_Depth_ft >= 0,
                               (Upper_Depth_ft+Lower_Depth_ft)/2, -9))

#Intersect the samples with the Penobscot River to ensure we are only looking
#at samples in our area of interest.

data_wrangle_4 <- data_wrangle_3 %>% 
  st_filter(Penobscot_clean) 

#create a summary table

```
#Spatial Map View
```{r}

 
```


#Mercury concetrations as related to Depth
How do Mercury levels change, based on depth? 

```{r}
DepthPlot.data <- data_wrangle_3%>%
  na.omit()


ggplot(SimpleDepthPlot.data,
       aes(x = Avg_Depth_ft, y = Max_Result_.Raw.)) +
  geom_point(alpha = 0.7, color = "darkblue") + 
  labs(
    title = "Mercury Concentration vs. Average Depth",
    x = "Average Sample Depth (ft)",
    y = "Mercury Concentration (PPM)"
  ) +
 theme_minimal ()


```

# Mercury concentrations as related to time. (Time Series Analysis)


```{r}

#preliminary wrangle for analysis 

MonthlyData <- data_wrangle_3 %>%
  mutate(Year = year(Date), Month = month(Date)) %>%
  group_by(Year, Month) %>%
  summarize(Mean_Conc = mean(Max_Result_.Raw., na.rm = TRUE), .groups = "drop")

MonthlyData_final <- MonthlyData %>%
  mutate(Date = ymd(paste0(Year, "-", Month, "-01"))) %>%
  select(Date, Mean_Conc)


#Plot Mercury Conentrations over time

ggplot(MonthlyData_final,
        aes(x = Date, y = Mean_Conc)) +
  geom_line() +
  geom_smooth(method = "lm")+
  labs(
  title= "Mean Mean Monthly Mercury Concentrations over Time (PPM)",
  x = "Date", 
  y = "Mean Monthly Mercury Concentrations (PPM)")+ 
 theme_minimal ()


```

#Multiple linear regressions and AIC

```{r}

```

# Statistical Analysis and Hypotehsis Testing 
```{r}

```

Sloane 11/24 - leaving off after doing initial data procesing, wrangling, and some visualization. There are a few spots to fill in (summary tables, figures, etc.), but the bulk of the processing/wrangling should be done!


